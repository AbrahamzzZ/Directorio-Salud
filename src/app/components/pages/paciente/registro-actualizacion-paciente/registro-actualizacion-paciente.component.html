<app-header></app-header>
    <h1>{{ isEditMode ? 'Editar Paciente' : 'Registrar Nuevo Paciente' }}</h1>
<div class="container">
  <mat-card class="form-card">   
    
    <mat-card-content>
      <form [formGroup]="pacienteForm" (ngSubmit)="onSubmit()">
        
         <div class="fila">
          <mat-form-field appearance="outline" class="completo">
            <mat-label>Nombre Completo</mat-label>
            <input matInput formControlName="nombre" placeholder="Nombre y apellidos">         
              <mat-error>
              @if(pacienteForm.get('nombre')?.invalid && pacienteForm.get('nombre')?.dirty || pacienteForm.get('nombre')?.touched) {
                @if(pacienteForm.get('nombre')?.errors?.['required']) {
                  El nombre es requerido
                }
                @else if (pacienteForm.get('nombre')?.errors?.['pattern']) {
                  El nombre no debe contener numeros
                }
                @else if(pacienteForm.get('nombre')?.errors?.['minlength']) {
                  El nombre debe tener al menos 3 caracteres
                }
              }                   
              </mat-error>
                     
          </mat-form-field>
        </div>
        
        <div class="fila doble">
          <mat-form-field appearance="outline">
            <mat-label>Correo</mat-label>
            <input matInput formControlName="correo" placeholder="ejemplo@email.com">
            <mat-error>
            @if(pacienteForm.get('correo')?.invalid && pacienteForm.get('correo')?.dirty || pacienteForm.get('correo')?.touched) {             
                @if(pacienteForm.get('correo')?.errors?.['required']) {
                  El correo es requerido
                }
                @if(pacienteForm.get('correo')?.errors?.['email']) {
                  Debe ingresar un correo electrónico válido
                }              
            }    
            </mat-error>        
          </mat-form-field>
          
          <mat-form-field appearance="outline">
            <mat-label>Telefono</mat-label>
            <input matInput formControlName="telefono" placeholder="0987654321">
            <mat-error>
            @if(pacienteForm.get('telefono')?.invalid && pacienteForm.get('telefono')?.dirty || pacienteForm.get('telefono')?.touched) {            
                @if(pacienteForm.get('telefono')?.errors?.['required']) {
                  El telefono es requerido
                }
                @if(pacienteForm.get('telefono')?.errors?.['pattern']) {
                  Debe ingresar un numero de 10 digitos
                }              
            }    
            </mat-error>        
          </mat-form-field>
        </div>
        
        <div class="fila doble">
          <mat-form-field appearance="outline">
            <mat-label>Edad</mat-label>
            <input matInput type="number" placeholder="Ingrese la edad" formControlName="Edad">
            <mat-error>
            @if(pacienteForm.get('Edad')?.invalid && pacienteForm.get('Edad')?.dirty || pacienteForm.get('Edad')?.touched) {
              
                @if(pacienteForm.get('Edad')?.errors?.['required']) {
                  La edad es requerida
                }
                @if(pacienteForm.get('Edad')?.errors?.['min']) {
                  La edad no puede ser negativa
                }
                @if(pacienteForm.get('Edad')?.errors?.['max']) {
                  La edad no puede ser mayor a 120 años
                }              
            } 
            </mat-error>           
          </mat-form-field>
          
          <mat-form-field appearance="outline">
            <mat-label>Tipo de Sangre</mat-label>
            <mat-select formControlName="tipoSangre">
              <mat-option *ngFor="let tipo of tiposDeSangre" [value]="tipo">
                {{tipo}}
              </mat-option>
            </mat-select>
            <mat-error>
            @if(pacienteForm.get('tipoSangre')?.invalid && pacienteForm.get('tipoSangre')?.dirty || pacienteForm.get('tipoSangre')?.touched) {
              
                @if(pacienteForm.get('tipoSangre')?.errors?.['required']) {
                  El tipo de sangre es requerido
                }              
            }
            </mat-error>
          </mat-form-field>
        </div>
        
        <div class="fila">
          <mat-form-field appearance="outline" class="completo">
            <mat-label>Diagnostico</mat-label>
            <textarea matInput formControlName="diagnostico" rows="3" placeholder="Diagnostico preliminar"></textarea>
            <mat-error>
            @if(pacienteForm.get('diagnostico')?.invalid && pacienteForm.get('diagnostico')?.dirty || pacienteForm.get('diagnostico')?.touched) {  
                @if(pacienteForm.get('diagnostico')?.errors?.['required']) {
                  El diagnostico es requerido
                }
                @if(pacienteForm.get('diagnostico')?.errors?.['minlength']) {
                  El diagnostico debe tener al menos 5 caracteres
                }
            }
            </mat-error>           
          </mat-form-field>
        </div>
        
        <div class="fila">
          <mat-form-field appearance="outline" class="completo">
            <mat-label>Metodo de Contacto Preferido</mat-label>
            <mat-select formControlName="contacto">
              <mat-option *ngFor="let metodo of metodosContacto" [value]="metodo">
                {{metodo}}
              </mat-option>
            </mat-select>            
              <mat-error>
              @if(pacienteForm.get('contacto')?.invalid && pacienteForm.get('contacto')?.dirty || pacienteForm.get('contacto')?.touched) {
                @if(pacienteForm.get('contacto')?.errors?.['required']) {
                  El metodo de contacto es requerido
                }
              } 
              </mat-error>                        
          </mat-form-field>
        </div>
        
        <div class="fila">
          <mat-form-field appearance="outline" class="fecha-registro-field">
            <mat-label for="fechaRegistro">Fecha de Registro</mat-label>
            <input matInput [matDatepicker]="picker" id="fechaRegistro" placeholder="DD/MM/YYYY" [min]="fechaMin" formControlName="fechaRegistro">
            <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>            
              <mat-error>
              @if(pacienteForm.get('fechaRegistro')?.invalid && pacienteForm.get('fechaRegistro')?.dirty || pacienteForm.get('fechaRegistro')?.touched) {
                @if(pacienteForm.get('fechaRegistro')?.errors?.['required']) {
                  La fecha es requerida
                }
              }
              </mat-error>            
          </mat-form-field>

          <div class="check">
              <mat-checkbox formControlName="estado" #estadoCheck>El paciente se encuentra activo?</mat-checkbox>
          </div>

        </div>
        
        <section class="botones">
          <div class="BtnContainer">
            <button mat-fab extended type="submit" [disabled]="pacienteForm.invalid">
              <mat-icon>{{ isEditMode ? 'edit' : 'person_add' }}</mat-icon>
              {{isEditMode ? 'Actualizar' : 'Guardar' }}
            </button>
          </div>

          <div class="BtnContainer">
            <button mat-fab extended color="warn" type="button" (click)="onCancel()" class="botonCancelar">
              <mat-icon>cancel</mat-icon>
              Cancelar
            </button>
          </div>
        </section>        
      </form>
    </mat-card-content>
  </mat-card>

</div>
<app-footer></app-footer>